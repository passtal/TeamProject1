<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      layout:decorate="~{/layouts/main_layout}">
<head>
    <title th:text="${notice.title} + ' - 두루두룹'">공지사항 상세</title>
    <link rel="stylesheet" th:href="@{/css/notice/notice-detail.css}">
</head>
<body layout:fragment="content">

<!-- 상단 버튼 -->
<div class="notice-actions">
    <div class="actions-container">
        <!-- 목록으로 버튼 -->
        <a href="/notice" class="btn-list">
            <span class="material-symbols-outlined">arrow_back</span>
            <span>목록으로</span>
        </a>

        <!-- 관리자 버튼 -->
        <div class="admin-buttons" sec:authorize="hasRole('ADMIN')">
            <a th:href="@{/notice/update/{noticeNo}(noticeNo=${notice.noticeNo})}" class="btn-edit">
                <span class="material-symbols-outlined">edit</span>
                <span>수정</span>
            </a>
            <button type="button" class="btn-delete" onclick="openDeleteModal()">
                <span class="material-symbols-outlined">delete</span>
                <span>삭제</span>
            </button>
        </div>
    </div>
</div>

<div class="notice-detail-page">
    <div class="notice-detail-container">
        <!-- 태그 -->
        <div class="notice-tags">
            <span th:each="tag : ${notice.tags}" 
                  th:class="${tag == '공지'} ? 'tag tag-notice' : 
                            (${tag == '이벤트'} ? 'tag tag-event' : 
                            (${tag == '업데이트'} ? 'tag tag-update' : 
                            (${tag == '점검'} ? 'tag tag-maintenance' : 
                            (${notice.important} ? 'tag tag-important' : 'tag'))))"
                  th:text="${tag}">공지</span>
        </div>

        <!-- 제목 -->
        <h1 class="notice-title" th:text="${notice.title}">두루두룹 서비스 정식 오픈 안내</h1>

        <!-- 메타 정보 -->
        <div class="notice-meta">
            <div class="meta-item">
                <span class="material-symbols-outlined">calendar_today</span>
                <span th:text="${#temporals.format(notice.regDate, 'yyyy-MM-dd')}">2026-01-20</span>
            </div>
            <div class="meta-item">
                <span class="material-symbols-outlined">visibility</span>
                <span th:text="'조회 ' + ${#numbers.formatInteger(notice.views, 0, 'COMMA')}">조회 1,245</span>
            </div>
        </div>

        <!-- 내용 -->
        <div class="notice-content" th:utext="${#strings.replace(notice.content, '&#10;', '<br>')}">
            안녕하세요, 두루두룹입니다!<br><br>
            드디어 소모임 커뮤니티 서비스 '두루두룹'이 정식으로 오픈되었습니다. 🎉
        </div>
    </div>
</div>

<!-- 삭제 확인 모달 -->
<div id="deleteModal" class="modal-overlay" style="display: none;">
    <div class="modal-container">
        <!-- 경고 아이콘 -->
        <div class="modal-icon">
            <span i class="material-symbols-outlined icon-large">delete</span>
        </div>
        
        <!-- 모달 제목 -->
        <h3 class="modal-title">공지사항을 삭제하시겠습니까?</h3>
        
        <!-- 모달 설명 -->
        <p class="modal-description">삭제된 공지사항은 복구할 수 없습니다.</p>
        
        <!-- 모달 버튼 -->
        <div class="modal-buttons">
            <button type="button" class="modal-btn-cancel" onclick="closeDeleteModal()">취소</button>
            <button type="button" class="modal-btn-delete" th:onclick="'deleteNotice(' + ${notice.noticeNo} + ')'">삭제</button>
        </div>
        
        <!-- 닫기 버튼 -->
        <button type="button" class="modal-close" onclick="closeDeleteModal()">
            <span class="material-symbols-outlined">close</span>
        </button>
    </div>
</div>

<script>
    // 모달 열기
    function openDeleteModal() {
        document.getElementById('deleteModal').style.display = 'flex';
        document.body.style.overflow = 'hidden'; // 스크롤 막기
    }

    // 모달 닫기
    function closeDeleteModal() {
        document.getElementById('deleteModal').style.display = 'none';
        document.body.style.overflow = 'auto'; // 스크롤 복원
    }

    // 삭제 실행
    function deleteNotice(noticeNo) {
        fetch('/notice/' + noticeNo, {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json'
            }
        })
        .then(response => {
            if (response.ok) {
                alert('공지사항이 삭제되었습니다.');
                window.location.href = '/notice';
            } else {
                alert('삭제 중 오류가 발생했습니다.');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('삭제 중 오류가 발생했습니다.');
        });
    }

    // 모달 배경 클릭 시 닫기
    document.getElementById('deleteModal').addEventListener('click', function(e) {
        if (e.target === this) {
            closeDeleteModal();
        }
    });
</script>

</body>
</html>