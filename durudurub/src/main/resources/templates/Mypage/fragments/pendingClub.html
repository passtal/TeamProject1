<!-- 신청 중인 모임 -->
    <div th:if="${type == 'PENDING'}">
        <div class="tab-content" id="pending">
            <div th:each="club : ${myclubList}" class="club-card" th:attr="data-club-no=${club.no}" style="cursor: pointer;">
                <div class="club-info">
                    <div class="club-icon gradient-orange">
                        <span class="material-symbols-outlined">restaurant</span>
                    </div>
                    <div class="club-details">
                        <div class="club-title-row">
                            <h3 class="club-title" th:text="${club.title}">모임명</h3>
                            <span class="status-badge pending">승인 대기 중</span>
                        </div>
                        <p class="club-category" th:text="${club.category != null ? club.category.name : '카테고리 없음'}">카테고리명</p>
                        <p class="club-members" th:text="|멤버 ${club.currentMembers}/${club.maxMembers}명|">가입 멤버수</p>
                    </div>
                </div>
                <div class="club-actions">
                    <button class="btn-cancel-request" th:attr="data-clubno=${club.no}" onclick="pendingOpenModal(this);">
                        <span class="material-symbols-outlined">close</span>
                        신청 취소
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 신청 취소 모달 -->
    <div id="cancelRequestModal" class="cancel-request-modal">
        <div class="cancel-request-modal-content">
            <div class="cancel-request-modal-header">
                <h3 class="cancel-request-modal-title">가입 신청 취소</h3>
                <button id="cancelRequestModalCloseBtn" class="cancel-request-modal-close" onclick="pendingCloseModal()">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
            <div class="cancel-request-modal-warning">
                <p class="cancel-request-modal-warning-text">모임의 가입 신청을 취소하시겠습니까?</p>
                <p class="cancel-request-modal-warning-subtext">취소하면 해당 모임의 가입 신청이 삭제됩니다.</p>
            </div>
            <div class="cancel-request-modal-actions">
                <button id="cancelRequestModalCancelBtn" class="cancel-request-modal-btn cancel-request-modal-btn-cancel" onclick="pendingCloseModal()">취소</button>
                <button id="cancelRequestModalConfirmBtn" class="cancel-request-modal-btn cancel-request-modal-btn-confirm">취소하기</button>
            </div>
        </div>
    </div>

<th:block th:replace="~{fragments/scripts :: scripts}">
    <script>
        // ⭐ 신청 중인 모임
    // 취소하기 버튼
    $(document).on("click", "#cancelRequestModalConfirmBtn", function () {
        // this 필요!
        const btn = $(this);
        const clubNo = btn.data("clubno");

        // CSRF 토큰 문제 (403)
        const token = $("meta[name='_csrf']").attr("content");
        const header = $("meta[name='_csrf_header']").attr("content");

        $.ajax({
            url: `/users/mypage/club/pending/${clubNo}`,
            method: 'DELETE',
            beforeSend: function (xhr) {     
                xhr.setRequestHeader(header, token);
            },
            success: function (result, status, xhr) {
                alert("신청이 취소되었습니다.")
                // 신청한 모임리스트 수 감소
                countList("PENDING", -1)
                // 취소한 모임리스트 카드 삭제
                $(`.club-card[data-club-no="${clubNo}"]`).remove();
                // 모달 닫기
                pendingCloseModal()
            }, 
            error: function (xhr, status, error) {
                // xhr : AJAX 요청에 대한 전체 HTTP 응답 객체
                // status : AJAX 요청 상태를 문자열로 나타낸 것
                if (xhr.status === 404) {
                    alert("잘못된 요청입니다");
                } else {
                    alert("서버 내부 오류입니다.")
                }
            }
        })
    })
    // 신청 취소 - 모달 열기 (취소하기 버튼)
    function pendingOpenModal(btnEl) {
        const clubNo = $(btnEl).data("clubno")
        $("#cancelRequestModalConfirmBtn").data("clubno", clubNo)
        $("#cancelRequestModal").show()
    }
    // 신청 취소 - 모달 닫기
    function pendingCloseModal() {
        $("#cancelRequestModal").hide()
    }
    </script>
</th:block>
