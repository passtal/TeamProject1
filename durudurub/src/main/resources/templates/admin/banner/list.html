<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{/layouts/main_layout}"
      th:with="isAdminPage=true">
<head>
    <title>광고 배너 관리 - 두루두룹 관리자</title>
    <th:block layout:fragment="css">
        <link rel="stylesheet" th:href="@{/css/admin/dashboard.css}">
        <link rel="stylesheet" th:href="@{/css/admin/banners.css}">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    </th:block>
</head>
<body>
    <main layout:fragment="content" class="main-content">
        <!-- Header -->
        <header class="page-header">
            <div class="header-left">
                <h1>관리자 대시보드</h1>
                <p>두루두룹 서비스 관리</p>
            </div>
            <button class="btn-main" onclick="location.href='/'">
                메인으로
            </button>
        </header>

        <!-- 관리자 네비게이션 -->
        <nav class="admin-nav">
            <button class="nav-tab" onclick="location.href='/admin/dashboard'">
                <span class="material-symbols-outlined">dashboard</span>
                대시보드
            </button>
            <button class="nav-tab" onclick="location.href='/admin/users'">
                <span class="material-symbols-outlined">group</span>
                사용자 관리
            </button>
            <button class="nav-tab" onclick="location.href='/admin/clubs'">
                <span class="material-symbols-outlined">diversity_3</span>
                모임 관리
            </button>
            <button class="nav-tab" onclick="location.href='/admin/reports'">
                <span class="material-symbols-outlined">report</span>
                신고 관리
            </button>
            <button class="nav-tab active" onclick="location.href='/admin/banners'">
                <span class="material-symbols-outlined">image</span>
                광고 배너 관리
            </button>
            <button class="nav-tab" onclick="location.href='/admin/categories'">
                <span class="material-symbols-outlined">category</span>
                카테고리 관리
            </button>
        </nav>

        <!-- 배너 관리 섹션 -->
        <div class="banners-section">
            <div class="section-header">
                <h2>광고 배너 관리</h2>
                <button class="btn-add-banner" onclick="location.href='/admin/adminpage/banner/insert'">
                    <span class="material-symbols-outlined">add</span>
                    배너 추가
                </button>
            </div>

            <div class="table-container">
                <table class="banners-table">
                    <thead>
                        <tr>
                            <th>순서</th>
                            <th>미리보기</th>
                            <th>제목</th>
                            <th>링크 URL</th>
                            <th>배너 위치</th>
                            <th>상태</th>
                            <th>작업</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr onclick="showBannerDetail(1)" style="cursor: pointer;">
                            <td class="text-center">1</td>
                            <td>
                                <div class="banner-preview">
                                    <img src="https://via.placeholder.com/168x60?text=Premium+Banner" alt="배너 미리보기">
                                </div>
                            </td>
                            <td>두루두룹 프리미엄 구독 홍보</td>
                            <td class="text-muted">/payment</td>
                            <td class="text-center">
                                <span class="position-badge position-main" onclick="event.stopPropagation(); togglePosition(this, 1)" style="cursor: pointer;" title="클릭하여 변경">Main</span>
                            </td>
                            <td class="text-center">
                                <span class="status-badge active" onclick="event.stopPropagation(); toggleStatus(this, 1)" style="cursor: pointer;" title="클릭하여 변경">활성화</span>
                            </td>
                            <td>
                                <div class="action-buttons">
                                    <button class="btn-edit" onclick="event.stopPropagation(); editBanner(1)" title="편집">
                                        <span class="material-symbols-outlined">edit</span>
                                    </button>
                                    <button class="btn-delete" onclick="event.stopPropagation(); deleteBanner(1, '두루두룹 프리미엄 구독 홍보')" title="삭제">
                                        <span class="material-symbols-outlined">delete</span>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        <tr onclick="showBannerDetail(2)" style="cursor: pointer;">
                            <td class="text-center">2</td>
                            <td>
                                <div class="banner-preview">
                                    <img src="https://via.placeholder.com/168x60?text=Event+Banner" alt="배너 미리보기">
                                </div>
                            </td>
                            <td>신규 모임 생성 이벤트</td>
                            <td class="text-muted">/explore</td>
                            <td class="text-center">
                                <span class="position-badge position-main" onclick="event.stopPropagation(); togglePosition(this, 2)" style="cursor: pointer;" title="클릭하여 변경">Main</span>
                            </td>
                            <td class="text-center">
                                <span class="status-badge active" onclick="event.stopPropagation(); toggleStatus(this, 2)" style="cursor: pointer;" title="클릭하여 변경">활성화</span>
                            </td>
                            <td>
                                <div class="action-buttons">
                                    <button class="btn-edit" onclick="event.stopPropagation(); editBanner(2)" title="편집">
                                        <span class="material-symbols-outlined">edit</span>
                                    </button>
                                    <button class="btn-delete" onclick="event.stopPropagation(); deleteBanner(2, '신규 모임 생성 이벤트')" title="삭제">
                                        <span class="material-symbols-outlined">delete</span>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        <tr class="inactive-row" onclick="showBannerDetail(3)" style="cursor: pointer;">
                            <td class="text-center">3</td>
                            <td>
                                <div class="banner-preview">
                                    <img src="https://via.placeholder.com/168x60?text=Summer+Sale" alt="배너 미리보기">
                                </div>
                            </td>
                            <td>여름 특별 할인</td>
                            <td class="text-muted">/payment</td>
                            <td class="text-center">
                                <span class="position-badge position-main" onclick="event.stopPropagation(); togglePosition(this, 3)" style="cursor: pointer;" title="클릭하여 변경">Main</span>
                            </td>
                            <td class="text-center">
                                <span class="status-badge inactive" onclick="event.stopPropagation(); toggleStatus(this, 3)" style="cursor: pointer;" title="클릭하여 변경">비활성화</span>
                            </td>
                            <td>
                                <div class="action-buttons">
                                    <button class="btn-edit" onclick="event.stopPropagation(); editBanner(3)" title="편집">
                                        <span class="material-symbols-outlined">edit</span>
                                    </button>
                                    <button class="btn-delete" onclick="event.stopPropagation(); deleteBanner(3, '여름 특별 할인')" title="삭제">
                                        <span class="material-symbols-outlined">delete</span>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- 배너 수정 모달 -->
        <div id="bannerEditModal" class="modal-overlay">
            <div class="modal-edit-container">
                <div class="modal-edit-header">
                    <h2>배너 수정</h2>
                    <button class="btn-close-modal" onclick="closeEditModal()">
                        <span class="material-symbols-outlined">close</span>
                    </button>
                </div>
                <div class="modal-edit-content">
                    <div class="form-group">
                        <label class="form-label">배너 제목</label>
                        <input type="text" id="editTitle" class="form-input" placeholder="제목을 입력하세요" value="두루두룹 프리미엄 구독 홍보">
                    </div>
                    <div class="form-group">
                        <label class="form-label">이미지</label>
                        <div class="image-input-group">
                            <input type="text" id="editImageUrl" class="form-input-image" placeholder="이미지 URL" value="https://via.placeholder.com/168x60?text=Premium+Banner">
                            <label class="btn-file-select">
                                파일 선택
                                <input type="file" accept="image/*" style="display: none;">
                            </label>
                        </div>
                        <p class="form-helper">URL 입력 또는 파일 선택 (권장 사이즈: 800x200px)</p>
                    </div>
                    <div class="form-group">
                        <label class="form-label">미리보기</label>
                        <div class="preview-image-container">
                            <img id="editPreviewImage" src="https://via.placeholder.com/168x60?text=Premium+Banner" alt="배너 미리보기">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">링크 URL</label>
                        <input type="text" id="editUrl" class="form-input" placeholder="/path" value="/payment">
                    </div>
                    <div class="form-group">
                        <label class="form-label">설명</label>
                        <textarea id="editDescription" class="form-textarea" placeholder="배너에 대한 간단한 설명을 입력하세요 (선택 사항)"></textarea>
                    </div>
                    <div class="form-group-row">
                        <div class="form-group">
                            <label class="form-label">노출 시작일</label>
                            <input type="date" id="editStartDate" class="form-input-date" value="2024-01-10">
                        </div>
                        <div class="form-group">
                            <label class="form-label">노출 종료일</label>
                            <input type="date" id="editEndDate" class="form-input-date" value="2024-12-31">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">표시 순서</label>
                        <input type="number" id="editOrder" class="form-input-number" min="1" value="1">
                    </div>
                    <div class="form-group-checkbox">
                        <input type="checkbox" id="editActive" class="form-checkbox" checked>
                        <label for="editActive" class="form-checkbox-label">배너 활성화</label>
                    </div>
                </div>
                <div class="modal-edit-footer">
                    <button class="btn-cancel" onclick="closeEditModal()">취소</button>
                    <button class="btn-save" onclick="saveBannerEdit()">수정</button>
                </div>
            </div>
        </div>

        <!-- 배너 상세 정보 모달 -->
        <div id="bannerDetailModal" class="modal-overlay">
            <div class="modal-detail-container">
                <div class="modal-detail-header">
                    <h2>배너 상세 정보</h2>
                    <button class="btn-close-modal" onclick="closeBannerDetailModal()">
                        <span class="material-symbols-outlined">close</span>
                    </button>
                </div>
                <div class="modal-detail-content">
                    <div class="detail-row">
                        <div class="detail-label">제목</div>
                        <div class="detail-value" id="detailTitle"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">이미지</div>
                        <div class="detail-image-container">
                            <img id="detailImage" src="" alt="배너 이미지">
                        </div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">링크 URL</div>
                        <div class="detail-value" id="detailUrl"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">설명</div>
                        <div class="detail-value" id="detailDescription"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">활성화 여부</div>
                        <span id="detailStatus" class="status-badge"></span>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">배너 위치</div>
                        <span class="position-badge" id="detailPosition"></span>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">노출 시작일</div>
                        <div class="detail-value" id="detailStartDate"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">노출 종료일</div>
                        <div class="detail-value" id="detailEndDate"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">정렬 순서</div>
                        <div class="detail-value" id="detailOrder"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">클릭 수</div>
                        <div class="detail-clicks" id="detailClicks"></div>
                    </div>
                </div>
                <div class="modal-detail-footer">
                    <button class="btn-close" onclick="closeBannerDetailModal()">닫기</button>
                </div>
            </div>
        </div>

        <!-- 삭제 확인 모달 -->
        <div id="deleteModal" class="delete-modal-overlay" onclick="if(event.target === this) closeDeleteModal()">
            <div class="delete-modal-container">
                <div class="delete-modal-header">
                    <h2>배너 삭제 확인</h2>
                    <button class="btn-close-modal" onclick="closeDeleteModal()">
                        <span class="material-symbols-outlined">close</span>
                    </button>
                </div>
                <div class="delete-modal-content">
                    <p>정말로 이 배너를 삭제하시겠습니까?</p>
                    <p class="delete-banner-title" id="deleteBannerTitle"></p>
                </div>
                <div class="delete-modal-footer">
                    <button class="btn-cancel" onclick="closeDeleteModal()">취소</button>
                    <button class="btn-confirm-delete" onclick="confirmDelete()">삭제</button>
                </div>
            </div>
        </div>

        <script>
            // 삭제할 배너 ID를 저장할 변수
            let bannerToDelete = null;

            // 샘플 배너 데이터
            const bannerData = {
                1: {
                    title: '두루두룹 프리미엄 구독 홍보',
                    image: 'https://via.placeholder.com/168x60?text=Premium+Banner',
                    url: '/payment',
                    description: '프리미엄 구독으로 무제한 AI 검색과 더 많은 기능을 즐겨보세요!',
                    status: '활성화',
                    position: 'Main',
                    startDate: '2024-01-10',
                    endDate: '2024-12-31',
                    order: 1,
                    clicks: '1,250회'
                },
                2: {
                    title: '신규 모임 생성 이벤트',
                    image: 'https://via.placeholder.com/168x60?text=Event+Banner',
                    url: '/explore',
                    description: '새로운 모임을 만들고 친구들과 함께 즐거운 시간을 보내세요!',
                    status: '활성화',
                    position: 'Main',
                    startDate: '2024-02-01',
                    endDate: '2024-03-31',
                    order: 2,
                    clicks: '890회'
                },
                3: {
                    title: '여름 특별 할인',
                    image: 'https://via.placeholder.com/168x60?text=Summer+Sale',
                    url: '/payment',
                    description: '여름 시즌 한정 특별 할인 혜택을 놓치지 마세요!',
                    status: '비활성화',
                    position: 'Main',
                    startDate: '2024-06-01',
                    endDate: '2024-08-31',
                    order: 3,
                    clicks: '450회'
                }
            };

            function showBannerDetail(id) {
                const banner = bannerData[id];
                if (!banner) return;

                // 모달에 데이터 채우기
                document.getElementById('detailTitle').textContent = banner.title;
                document.getElementById('detailImage').src = banner.image;
                document.getElementById('detailUrl').textContent = banner.url;
                document.getElementById('detailDescription').textContent = banner.description;
                
                const statusBadge = document.getElementById('detailStatus');
                statusBadge.textContent = banner.status;
                statusBadge.className = banner.status === '활성화' ? 'status-badge active' : 'status-badge inactive';
                
                document.getElementById('detailPosition').textContent = banner.position;
                document.getElementById('detailStartDate').textContent = banner.startDate;
                document.getElementById('detailEndDate').textContent = banner.endDate;
                document.getElementById('detailOrder').textContent = banner.order;
                document.getElementById('detailClicks').textContent = banner.clicks;

                // 모달 표시
                document.getElementById('bannerDetailModal').style.display = 'flex';
            }

            function closeBannerDetailModal() {
                document.getElementById('bannerDetailModal').style.display = 'none';
            }

            // 모달 외부 클릭 시 닫기
            document.getElementById('bannerDetailModal')?.addEventListener('click', function(e) {
                if (e.target === this) {
                    closeBannerDetailModal();
                }
            });

            function openAddBannerModal() {
                alert('배너 추가 기능은 준비 중입니다.');
                // TODO: 배너 추가 모달 구현
            }
            
            function editBanner(id) {
                const banner = bannerData[id];
                if (!banner) return;

                // 폼에 데이터 채우기
                document.getElementById('editTitle').value = banner.title;
                document.getElementById('editImageUrl').value = banner.image;
                document.getElementById('editPreviewImage').src = banner.image;
                document.getElementById('editUrl').value = banner.url;
                document.getElementById('editDescription').value = banner.description;
                document.getElementById('editStartDate').value = banner.startDate;
                document.getElementById('editEndDate').value = banner.endDate;
                document.getElementById('editOrder').value = banner.order;
                document.getElementById('editActive').checked = banner.status === '활성화';

                // 모달 표시
                document.getElementById('bannerEditModal').style.display = 'flex';
            }

            function closeEditModal() {
                document.getElementById('bannerEditModal').style.display = 'none';
            }

            function saveBannerEdit() {
                const title = document.getElementById('editTitle').value;
                const imageUrl = document.getElementById('editImageUrl').value;
                const url = document.getElementById('editUrl').value;
                const description = document.getElementById('editDescription').value;
                const startDate = document.getElementById('editStartDate').value;
                const endDate = document.getElementById('editEndDate').value;
                const order = document.getElementById('editOrder').value;
                const active = document.getElementById('editActive').checked;

                console.log('수정 데이터:', {
                    title, imageUrl, url, description, startDate, endDate, order, active
                });

                alert('배너가 수정되었습니다.');
                closeEditModal();
                // TODO: Ajax로 서버에 수정 요청
            }

            // 이미지 URL 변경 시 미리보기 업데이트
            document.getElementById('editImageUrl')?.addEventListener('input', function(e) {
                document.getElementById('editPreviewImage').src = e.target.value;
            });

            // 수정 모달 외부 클릭 시 닫기
            document.getElementById('bannerEditModal')?.addEventListener('click', function(e) {
                if (e.target === this) {
                    closeEditModal();
                }
            });
            
            function deleteBanner(id, title) {
                bannerToDelete = id;
                document.getElementById('deleteBannerTitle').textContent = title ? `"${title}"` : '';
                document.getElementById('deleteModal').style.display = 'flex';
            }
            
            function closeDeleteModal() {
                document.getElementById('deleteModal').style.display = 'none';
                bannerToDelete = null;
            }
            
            function confirmDelete() {
                if (bannerToDelete) {
                    console.log('배너 삭제:', bannerToDelete);
                    // TODO: 서버에 삭제 요청
                    // 성공 시:
                    closeDeleteModal();
                    showToast('배너가 삭제되었습니다');
                }
            }
            
            function togglePosition(element, bannerId) {
                const currentPosition = element.textContent.trim();
                const newPosition = currentPosition === 'Main' ? 'Popup' : 'Main';
                
                // 텍스트 변경
                element.textContent = newPosition;
                
                // 클래스 변경
                if (newPosition === 'Main') {
                    element.classList.remove('position-popup');
                    element.classList.add('position-main');
                } else {
                    element.classList.remove('position-main');
                    element.classList.add('position-popup');
                }
                
                console.log(`배너 ${bannerId} 위치 변경: ${currentPosition} -> ${newPosition}`);
                // TODO: Ajax로 서버에 위치 변경 요청
            }
            
            function toggleStatus(element, bannerId) {
                const currentStatus = element.textContent.trim();
                const newStatus = currentStatus === '활성화' ? '비활성화' : '활성화';
                
                // 텍스트 변경
                element.textContent = newStatus;
                
                // 클래스 변경
                if (newStatus === '활성화') {
                    element.classList.remove('inactive');
                    element.classList.add('active');
                } else {
                    element.classList.remove('active');
                    element.classList.add('inactive');
                }
                
                // 행(row) 찾아서 희미하게 만들기
                const row = element.closest('tr');
                if (newStatus === '비활성화') {
                    row.classList.add('inactive-row');
                } else {
                    row.classList.remove('inactive-row');
                }
                
                console.log(`배너 ${bannerId} 상태 변경: ${currentStatus} -> ${newStatus}`);
                // TODO: Ajax로 서버에 상태 변경 요청
            }
        </script>
    </main>

    <th:block layout:fragment="script"></th:block>
</body>
</html>
