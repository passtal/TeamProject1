<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{/layouts/main_layout}">

      <!-- ì„ì‹œ css -->
       <!-- <link rel="stylesheet" href="../../static/css/list.css"> -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ëª¨ì„ ë‘˜ëŸ¬ë³´ê¸° - ë‘ë£¨ë‘ë£¹</title>
    <th:block layout:fragment="css">
        <link rel="stylesheet" th:href="@{/css/category/list.css}">
    </th:block>
</head>
<body>
    <main layout:fragment="content">
        <!-- ëª¨ì„ íƒìƒ‰ í˜ì´ì§€ -->
        <section class="explore-page">
            <div class="explore-container">
                <!-- ì¹´í…Œê³ ë¦¬ í•„í„° -->
                <div class="category-filter">
                    <!-- ì „ì²´ ë²„íŠ¼ -->
                    <button class="filter-btn active" data-category="all" data-type="all">
                        <i class="bi bi-search"></i>
                        <span>ì „ì²´</span>
                    </button>
                    
                    <button th:each="category : ${categories}" 
                            class="filter-btn" 
                            th:data-category="${category.name}"
                            th:data-category-no="${category.no}"
                            data-type="main">
                        <i th:if="${category.icon != null and category.icon.startsWith('bi-')}" 
                           th:class="'bi ' + ${category.icon}"></i>
                        <span th:if="${category.icon == null or !category.icon.startsWith('bi-')}" 
                              th:text="${category.icon != null ? category.icon : 'ğŸ“'}">ğŸ“</span>
                        <span th:text="${category.name}">ì¹´í…Œê³ ë¦¬</span>
                    </button>
                </div>
            </div>
        </section>

        <!-- ëª¨ì„ ëª©ë¡ ì„¹ì…˜ -->
        <section class="clubs-section py-5">
            <div class="container">
                <!-- í—¤ë” -->
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h3 class="section-title mb-0" id="section-title">
                        <span>ëª¨ë“  ëª¨ì„</span>
                    </h3>
                    <a th:href="@{/club/create}" class="create-club-btn">
                        <i class="bi bi-plus-lg"></i>
                        <span>ëª¨ì„ ë§Œë“¤ê¸°</span>
                    </a>
                </div>
                
                <!-- ê²°ê³¼ ì¹´ìš´íŠ¸ -->
                <p class="result-count">
                    <span id="club-count" th:text="${#lists.size(clubs)}">0</span>ê°œì˜ ëª¨ì„ (ìµœì‹ ìˆœ)
                </p>
                
                <!-- ëª¨ì„ ì¹´ë“œ ê·¸ë¦¬ë“œ -->
                <div class="row g-4" id="club-grid">
                    <div th:if="${clubs == null or clubs.empty}" class="col-12 text-center py-5">
                        <p class="text-muted">ì•„ì§ ëª¨ì„ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                        <a th:href="@{/club/create}" class="btn btn-join" sec:authorize="isAuthenticated()">
                            ì²« ëª¨ì„ ë§Œë“¤ê¸°
                        </a>
                    </div>

                    <div th:each="club : ${clubs}" class="col-md-6 col-lg-4 club-card-wrapper" 
                         th:data-category="${club.category != null ? club.category.name : ''}"
                         th:data-category-no="${club.categoryNo}">
                        <div class="card club-card h-100 shadow-sm">
                            <!-- ëª¨ì„ ì´ë¯¸ì§€ -->
                            <div class="club-card-image">
                                <img th:src="${club.thumbnailImg != null} ? ${club.thumbnailImg} : @{/img/hero-image.png}" 
                                     class="card-img-top" alt="ëª¨ì„ ì´ë¯¸ì§€">
                                <span class="club-status badge" 
                                      th:classappend="${club.status == 'RECRUITING'} ? 'bg-success' : 'bg-secondary'"
                                      th:text="${club.status == 'RECRUITING'} ? 'ëª¨ì§‘ì¤‘' : 'ëª¨ì§‘ë§ˆê°'">ëª¨ì§‘ì¤‘</span>
                            </div>
                            
                            <div class="card-body">
                                <!-- ì¹´í…Œê³ ë¦¬ -->
                                <span class="badge bg-light text-dark mb-2" th:text="${club.category.name}">ì¹´í…Œê³ ë¦¬</span>
                                
                                <!-- ëª¨ì„ ì œëª© -->
                                <h5 class="card-title">
                                    <a th:href="@{/club/{no}(no=${club.no})}" class="text-decoration-none text-dark"
                                       th:text="${club.title}">ëª¨ì„ ì´ë¦„</a>
                                </h5>
                                
                                <!-- ëª¨ì„ ì„¤ëª… -->
                                <p class="card-text text-muted small" 
                                   th:text="${#strings.abbreviate(club.description, 60)}">ëª¨ì„ ì†Œê°œê¸€...</p>
                                
                                <!-- ëª¨ì„ ì •ë³´ -->
                                <div class="club-meta d-flex justify-content-between align-items-center mt-3">
                                    <div class="d-flex align-items-center gap-2">
                                        <i class="bi bi-people"></i>
                                        <small th:text="${club.currentMembers} + '/' + ${club.maxMembers} + 'ëª…'">0/10ëª…</small>
                                    </div>
                                    <div class="d-flex align-items-center gap-2">
                                        <i class="bi bi-geo-alt"></i>
                                        <small th:text="${club.location}">ì„œìš¸</small>
                                    </div>
                                    <div class="d-flex align-items-center gap-2">
                                        <i class="bi bi-heart"></i>
                                        <small th:text="${club.likeCount}">0</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- í•„í„°ë§ ê²°ê³¼ ì—†ì„ ë•Œ -->
                <div class="empty-state" id="empty-state" style="display: none;">
                    <div class="empty-state-icon">ğŸ”</div>
                    <h3>í•´ë‹¹ ì¹´í…Œê³ ë¦¬ì˜ ëª¨ì„ì´ ì—†ìŠµë‹ˆë‹¤</h3>
                    <p>ë‹¤ë¥¸ ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•´ë³´ì„¸ìš”</p>
                </div>
            </div>
        </section>
    </main>
    
    <th:block layout:fragment="script">
        <script th:inline="javascript">
            document.addEventListener('DOMContentLoaded', function() {
                console.log('Club list page loaded');
                
                // URLì—ì„œ category íŒŒë¼ë¯¸í„° í™•ì¸
                const urlParams = new URLSearchParams(window.location.search);
                const urlCategoryNo = urlParams.get('category');
                
                // ëŒ€ë¶„ë¥˜ ì¹´í…Œê³ ë¦¬ í•„í„° ê¸°ëŠ¥
                const filterButtons = document.querySelectorAll('.category-filter .filter-btn');
                
                filterButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        const type = this.getAttribute('data-type');
                        const categoryNo = this.getAttribute('data-category-no');
                        const categoryName = this.getAttribute('data-category');
                        
                        // ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ë³€ê²½
                        filterButtons.forEach(btn => btn.classList.remove('active'));
                        this.classList.add('active');
                        
                        if (type === 'all') {
                            showAllClubs();
                            document.getElementById('section-title').innerHTML = '<span>ëª¨ë“  ëª¨ì„</span>';
                        } else if (categoryNo) {
                            filterClubsByCategory(categoryNo);
                            document.getElementById('section-title').innerHTML = '<span>' + categoryName + ' ëª¨ì„</span>';
                        }
                    });
                });
                
                // URL íŒŒë¼ë¯¸í„°ê°€ ìˆìœ¼ë©´ í•´ë‹¹ ì¹´í…Œê³ ë¦¬ ìë™ ì„ íƒ
                if (urlCategoryNo) {
                    const targetBtn = document.querySelector('.filter-btn[data-category-no="' + urlCategoryNo + '"]');
                    if (targetBtn) {
                        targetBtn.click();
                    }
                }
            });
            
            // ì „ì²´ ëª¨ì„ í‘œì‹œ
            function showAllClubs() {
                const cards = document.querySelectorAll('.club-card-wrapper');
                cards.forEach(card => card.style.display = '');
                updateEmptyState(cards.length);
            }
            
            // ì¹´í…Œê³ ë¦¬ë³„ í•„í„°ë§
            function filterClubsByCategory(categoryNo) {
                const cards = document.querySelectorAll('.club-card-wrapper');
                let visibleCount = 0;
                
                cards.forEach(card => {
                    const cardCategoryNo = card.getAttribute('data-category-no');
                    
                    if (cardCategoryNo == categoryNo) {
                        card.style.display = '';
                        visibleCount++;
                    } else {
                        card.style.display = 'none';
                    }
                });
                
                updateEmptyState(visibleCount);
            }
            
            // ë¹ˆ ìƒíƒœ ì—…ë°ì´íŠ¸
            function updateEmptyState(count) {
                document.getElementById('club-count').textContent = count;
                
                const emptyState = document.getElementById('empty-state');
                
                if (count === 0) {
                    emptyState.style.display = 'block';
                } else {
                    emptyState.style.display = 'none';
                }
            }
        </script>
    </th:block>
</body>
</html>