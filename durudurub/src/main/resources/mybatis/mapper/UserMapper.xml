<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 회원 매퍼 XML -->
<mapper namespace="com.aloha.durudurub.dao.UserMapper">

    <resultMap id="UserMap" type="com.aloha.durudurub.dto.User">
        <id property="no" column="no"/>

        <result property="id" column="id"/>
        <result property="userId" column="user_id"/>
        <result property="username" column="username"/>
        <result property="password" column="password"/>

        <result property="address" column="address"/>
        <result property="gender" column="gender"/>
        <result property="profileImg" column="profile_img"/>
        <result property="age" column="age"/>
        <result property="reportCount" column="report_count"/>

        <result property="createdAt" column="created_at"/>
        <result property="updatedAt" column="updated_at"/>
    </resultMap>

    <!-- 회원 가입 -->
    <insert id="insert" parameterType="com.aloha.durudurub.dto.User"
            useGeneratedKeys="true" keyProperty="no">
        INSERT INTO users (
            id, user_id, password, username,
            address, gender, profile_img, age
        ) VALUES (
            UUID(), #{userId}, #{password}, #{username},
            #{address}, #{gender}, #{profileImg}, #{age}
        )
    </insert>

    <!-- 로그인/중복체크: user_id(이메일)로 회원 조회 -->
    <select id="selectByUserId" parameterType="string" resultMap="UserMap">
        SELECT
            no, id, user_id, password, username,
            profile_img, age, gender, address,
            report_count, created_at, updated_at
        FROM users
        WHERE user_id = #{userId}
    </select>

    <!-- 닉네임 중복체크: username(닉네임)으로 회원 조회 -->
    <select id="selectByUsername" parameterType="string" resultMap="UserMap">
        SELECT
            no, id, user_id, password, username,
            profile_img, age, gender, address,
            report_count, created_at, updated_at
        FROM users
        WHERE username = #{username}
    </select>

    <!-- 회원 번호(no)로 조회 -->
    <select id="selectByNo" parameterType="int" resultMap="UserMap">
        SELECT
            no, id, user_id, username, password,
            address, gender, profile_img, age, report_count,
            created_at, updated_at
        FROM users
        WHERE no = #{no}
    </select>

    <!-- 회원 수정 (no 기준) -->
    <update id="update" parameterType="com.aloha.durudurub.dto.User">
        UPDATE users
        SET
            username    = #{username},
            address     = #{address},
            gender      = #{gender},
            profile_img = #{profileImg},
            age         = #{age}
        WHERE no = #{no}
    </update>

</mapper>
